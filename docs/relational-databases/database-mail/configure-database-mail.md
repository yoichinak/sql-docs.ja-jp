---
description: データベース メールを構成する
title: データベース メールの構成 | Microsoft Docs
ms.custom: ''
ms.date: 03/14/2017
ms.prod: sql
ms.prod_service: database-engine
ms.reviewer: ''
ms.technology: ''
ms.topic: conceptual
f1_keywords:
- sql13.swb.sqlimail.profileandaccountmanagement.f1
- sql13.swb.sqlimail.newaccount.f1
- sql13.swb.dbmail. manageprofilesecurity.profileview.f1
- sql13.swb.sqlimail.manageexistingprofile.f1
- sql13.swb.sqlimail.addaccounttoprofile.f1
- sql13.swb.dbmail.manageexistingaccount.f1
- sql13.swb.sqlimail.manageprofilesecurity.profileview.f1
- sql13.swb.sqlimail.welcome.f1
- sql13.swb.sqlimail.manageprofilesecurity.principalview.f1
- sql13.swb.sqlimail.newsqlimailaccount.f1
- sql13.swb.sqlimail.selectconfiguration.f1
- sql13.swb.dbmail.completewizard.f1
- sql13.swb.dbmail.sendtestemail.test.f1
- sql13.swb.sqlimail.newprofile.f1
- sql13.swb.dbmail.addaccounttoprofile.f1
- sql13.swb.dbmail.newprofile.f1
- sql13.swb.sqlimail.manageexistingaccount.f1
- sql13.swb.dbmail.welcome.f1
- sql13.swb.dbmail.newaccount.f1
- sql13.swb.dbmail.profileandaccountmanagement.f1
- sql13.swb.dbmail.selectconfiguration.f1
- sql13.swb.dbmail.sendtestemail.f1
- sql13.swb.sqlimail.completewizard.f1
- sql13.swb.dbmail.configuresystem.f1
- sql13.swb.sqlimail.configuresystem.f1
- sql13.swb.dbmail.newsqlimailaccount.f1
- sql13.swb.dbmail.manageexistingprofile.f1
- sql13.swb.dbmail.manageprofilesecurity.principalview.f1
ms.assetid: 7edc21d4-ccf3-42a9-84c0-3f70333efce6
author: stevestein
ms.author: sstein
ms.openlocfilehash: daf9915e1aff8cf800fbc68929e7efdd6f95f4a2
ms.sourcegitcommit: 192f6a99e19e66f0f817fdb1977f564b2aaa133b
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 11/25/2020
ms.locfileid: "96126916"
---
# <a name="configure-database-mail"></a>データベース メールを構成する
 [!INCLUDE [SQL Server](../../includes/applies-to-version/sqlserver.md)]
  このトピックでは、データベース メール構成ウィザードを使用してデータベース メールを有効化して構成する方法、およびテンプレートを使用してデータベース メール構成スクリプトを作成する方法について説明します。  
  
-   **作業を開始する準備:** [制限事項と制約事項](#Restrictions)、[セキュリティ](#Security)  
  
-   **データベース メールの構成:**  [データベース メール構成ウィザードの使用](#DBWizard)、 [テンプレートの使用](#Template)  
  
##  <a name="before-you-begin"></a><a name="BeforeYouBegin"></a> はじめに  
 **Database Mail XPs** オプションを使用して、サーバーのデータベース メールを有効にします。 詳細については、「 [Database Mail XPs サーバー構成オプション](../../database-engine/configure-windows/database-mail-xps-server-configuration-option.md) 」を参照してください。  
  
###  <a name="limitations-and-restrictions"></a><a name="Restrictions"></a> 制限事項と制約事項  
 任意のデータベースで [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Service Broker を有効にするには、データベース ロックが必要です。 **msdb** で Service Broker が非アクティブ化された場合、データベース メールを有効にするには、最初に [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] エージェントを停止し、Service Broker が必要なロックを取得できるようにします。  
  
###  <a name="security"></a><a name="Security"></a> セキュリティ  
 データベース メールを構成するには、 **sysadmin** 固定サーバー ロールのメンバーである必要があります。 データベース メールを送信するには、 **msdb** データベースの **DatabaseMailUserRole** データベース ロールのメンバーである必要があります。  
  
##  <a name="using-database-mail-configuration-wizard"></a><a name="DBWizard"></a> データベース メール構成ウィザードの使用  
 **ウィザードを使用してデータベース メールを構成するには**  
  
1.  オブジェクト エクスプローラーで、データベース メールを構成するインスタンスのノードを展開します。  
  
2.  **[管理]** ノードを展開します。  
  
3.  **[データベース メール]** を右クリックして、 **[データベース メールの構成]** をクリックします。  
  
4.  ウィザードの各ダイアログの手順を実行します。  

    -   [[ようこそ] ページ](#Welcome)  
  
    -   [[構成タスクの選択] ページ](#ConfigTask)  
  
    -   [[新しいアカウント] ページ](#NewAccount)  
  
    -   [[既存のアカウントの管理] ページ](#ExistingAccount)  
  
    -   [[新しいプロファイル] ページ](#NewProfile)  
  
    -   [[既存のプロファイルの管理] ページ](#ExistingProfile)  
  
    -   [[アカウントをプロファイルに追加する] ページ](#AddAccount)  
  
    -   [[プロファイルとアカウントの管理] ページ](#AccountsProfiles)  
  
    -   [[プロファイル セキュリティの管理]、[パブリック プロファイル] タブ](#ProfileSecurityPublic)  
  
    -   [[プロファイル セキュリティの管理]、[プライベート プロファイル] タブ](#ProfileSecurityPrivate)  
  
    -   [[システム パラメーターの構成] ページ](#SystemParameters)  
  
    -   [[ウィザードの完了] ページ](#CompleteWizard)  
  
    -   [[テスト電子メールの送信] ページ](#TestEmail)  
  
###  <a name="welcome-page"></a><a name="Welcome"></a> [ようこそ] ページ  
 このページでは、データベース メールを構成する手順について説明します。  
  
 **[次回からこのページを表示しない]** : オンにすると、今後このページは表示されなくなります。  
  
 **[次へ]** : **[構成タスクの選択]** ページに進みます。  
  
 **[キャンセル]** : データベース メールを更新せずにウィザードを終了します。  
  
 [データベース メール構成ウィザードの使用](#DBWizard)  
  
###  <a name="select-configuration-task"></a><a name="ConfigTask"></a> [構成タスクの選択]  
 ウィザードを使用するたびに、 **[構成タスクの選択]** ページを使用して、完了するタスクを指定します。 ウィザードを完了する前に変更が必要になった場合は、 **[戻る]** ボタンを使用してこのページに戻り、別のタスクを選択します。  
  
> [!NOTE]  
>  データベース メール機能が有効になっていない場合は、" **データベース メール機能は使用できません。有効にしますか? " というメッセージが表示されます。** ここで **[はい]** をクリックすることは、 [sp_configure](../../database-engine/configure-windows/database-mail-xps-server-configuration-option.md) システム ストアド プロシージャの **Database Mail XPs オプション** を使用してデータベース メールを有効にすることと同じです。  
  
 **[次のタスクを実行してデータベース メールをセットアップする]**  
 データベース メールを初めてセットアップするときに必要なタスクをすべて実行します。 このオプションには、他の 3 つのオプションがすべて含まれています。  
  
 **[データベース メール アカウントおよびプロファイルを管理する]**  
 新しいデータベース メール アカウントおよびプロファイルの作成や、既存のデータベース メール アカウントおよびプロファイルの表示、変更、または削除を行います。  
  
 **[プロファイル セキュリティの管理]**  
 データベース メール プロファイルへのアクセスを許可するユーザーを構成します。  
  
 **[システム パラメーターを表示または変更する]**  
 添付ファイルの最大ファイル サイズなど、データベース メールのシステム パラメーターを構成します。  
  
 [データベース メール構成ウィザードの使用](#DBWizard)  
  
###  <a name="new-account-page"></a><a name="NewAccount"></a> [新しいアカウント] ページ  
 このページを使用すると、新しいデータベース メール アカウントを作成できます。 データベース メール アカウントには、SMTP サーバーへの電子メール送信に関する情報が含まれます。  
  
 データベース メール アカウントには、 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] から SMTP サーバーに電子メールを送信するときに使用される情報が含まれています。 各アカウントに、1 つの電子メール サーバーの情報が含まれます。  
  
 データベース メール アカウントは、データベース メールにのみ使用されます。 これは、 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] アカウントや Microsoft Windows アカウントには対応していません。 データベース メールは、 [!INCLUDE[ssDEnoversion](../../includes/ssdenoversion-md.md)]の資格情報、または指定したその他の資格情報を使用して送信できます。または、匿名で送信することもできます。 基本認証を使用する場合、データベース メール アカウントのユーザー名とパスワードは、電子メール サーバーとの認証だけに使用されます。 アカウントは、 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] ユーザー、または [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]が動作しているコンピューターのユーザーに対応している必要はありません。  
  
 **アカウント名**  
 新しいアカウントの名前を入力します。  
  
 **説明**  
 アカウントの説明を入力します。 説明は省略できます。  
  
 **[電子メール アドレス]**  
 アカウントの電子メール アドレスの名前を入力します。 これは、電子メールの送信元の電子メール アドレスです。 たとえば、[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] エージェントのアカウントは、SqlAgent@Adventure-Works.com というアドレスから電子メールを送信できます。  
  
 **表示名**  
 このアカウントから送信する電子メール メッセージに表示する名前を入力します。 表示名はオプションです。 これは、このアカウントから送信されたメッセージに表示されます。 たとえば、 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] エージェントのアカウントは、電子メール メッセージに "SQL Server Agent Automated Mailer" という名前を表示できます。  
  
 **[電子メールの返信]**  
 このアカウントから送信された電子メール メッセージへの返信に使用される電子メール アドレスを入力します。 電子メールの返信はオプションです。 たとえば、[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] エージェントのアカウントへの返信は、データベース管理者 danw@Adventure-Works.com をクリックします。  
  
 **サーバー名**  
 アカウントが電子メールの送信に使用する SMTP サーバーの名前または IP アドレスを入力します。 通常、これは **smtp.** _<your_company>_ **.com** のような形式になります。 詳細については、電子メールの管理者に問い合わせてください。  
  
 **ポート番号**  
 このアカウントで使用する SMTP サーバーのポート番号を入力します。 ほとんどの SMTP サーバーでは、ポート 25 が使用されます。  
  
 **[このサーバーはセキュリティで保護された接続 (SSL) を必要とする]**  
 SSL (Secure Sockets Layer) を使用して通信を暗号化します。  
  
 **[データベース エンジン サービスの資格情報を使用する Windows 認証]**  
 [!INCLUDE[ssDEnoversion](../../includes/ssdenoversion-md.md)] サービスに対して構成されている資格情報を使用して、SMTP サーバーとの接続を確立します。  
  
 **基本認証**  
 SMTP サーバーで必要なユーザー名およびパスワードを指定します。  
  
 **ユーザー名**  
 データベース メールで SMTP サーバーへのログインに使用されるユーザー名を入力します。 SMTP サーバーで基本認証が求められる場合、ユーザー名が必要になります。  
  
 **パスワード**  
 データベース メールで SMTP サーバーへのログインに使用されるパスワードを入力します。 SMTP サーバーで基本認証が求められる場合、パスワードが必要になります。  
  
 **[パスワードの確認入力]**  
 パスワードに間違いがないことを確認するために、設定したパスワードをもう一度入力します。 SMTP サーバーで基本認証が求められる場合、パスワードが必要になります。  
  
 **[匿名認証]**  
 メールはログイン資格情報なしで SMTP サーバーに送信されます。 このオプションは、SMTP サーバーで認証が必要ない場合に使用します。  
  
 [データベース メール構成ウィザードの使用](#DBWizard)  
  
###  <a name="manage-existing-account-page"></a><a name="ExistingAccount"></a> [既存のアカウントの管理] ページ  
 このページを使用すると、既存のデータベース メール アカウントを管理できます。  
  
 **アカウント名**  
 表示、更新、または削除するアカウントを選択します。  
  
 **削除**  
 選択されているアカウントを削除します。 関連付けられたプロファイルからこのアカウントを削除するか、選択したアカウントを削除する前にこのようなプロファイルを削除する必要があります。  
  
 **説明**  
 アカウントの説明を表示または更新します。 説明は省略できます。  
  
 **[電子メール アドレス]**  
 アカウントの電子メール アドレスの名前を表示または更新します。 これは、電子メールの送信元の電子メール アドレスです。 たとえば、Microsoft SQL Server エージェントのアカウントは、**SqlAgent\@Adventure-Works.com** というアドレスから電子メールを送信できます。  
  
 **表示名**  
 このアカウントから送信する電子メール メッセージに表示する名前を表示または更新します。 表示名はオプションです。 これは、このアカウントから送信されたメッセージに表示されます。 たとえば、SQL Server エージェントのアカウントは、電子メールのメッセージに " **SQL Server Agent Automated Mailer** " という名前を表示できます。  
  
 **[電子メールの返信]**  
 このアカウントから送信された電子メール メッセージへの返信に使用される電子メール アドレスを表示または更新します。 電子メールの返信はオプションです。 たとえば、SQL Server エージェントのアカウントへの返信は、データベース管理者 **danw\@Adventure-Works.com** に送信できます。  
  
 **サーバー名**  
 アカウントが電子メールの送信に使用する SMTP サーバーの名前を表示または更新します。 通常、これは **smtp.<your_company>.com** のような形式になります。 詳細については、電子メールの管理者に問い合わせてください。  
  
 **ポート番号**  
 このアカウントの SMTP サーバーのポート番号を表示または更新します。 ほとんどの SMTP サーバーでは、ポート 25 が使用されます。  
  
 **[このサーバーはセキュリティで保護された接続 (SSL) を必要とする]**  
 SSL (Secure Sockets Layer) を使用して通信を暗号化します。  
  
 **[データベース エンジン サービスの資格情報を使用する Windows 認証]**  
 [!INCLUDE[ssDEnoversion](../../includes/ssdenoversion-md.md)] サービスに対して構成されている資格情報を使用して、SMTP サーバーとの接続を確立します。  
  
 **基本認証**  
 SMTP サーバーで必要なユーザー名およびパスワードを指定します。  
  
 **ユーザー名**  
 データベース メールで SMTP サーバーへのログインに使用されるユーザー名を表示または更新します。 SMTP サーバーで基本認証が求められる場合、ユーザー名が必要になります。  
  
 **パスワード**  
 データベース メールで SMTP サーバーへのログインに使用されるパスワードを変更します。 SMTP サーバーで基本認証が求められる場合、パスワードが必要になります。  
  
 **[パスワードの確認入力]**  
 パスワードに間違いがないことを確認するために、設定したパスワードをもう一度入力します。 SMTP サーバーで基本認証が求められる場合、パスワードが必要になります。  
  
 **[匿名認証]**  
 メールはログイン資格情報なしで SMTP サーバーに送信されます。 このオプションは、SMTP サーバーで認証が必要ない場合に使用します。  
  
 [データベース メール構成ウィザードの使用](#DBWizard)  
  
###  <a name="new-profile-page"></a><a name="NewProfile"></a> [新しいプロファイル] ページ  
 このページを使用すると、データベース メール アカウントを作成します。 データベース メール プロファイルは、データベース メール アカウントのコレクションです。 プロファイルは、電子メール サーバーが到達不能になった場合に、代わりのデータベース メール アカウントを提供することにより、信頼性を向上させます。 少なくとも 1 つのデータベース メール アカウントが必要です。 プロファイルのデータベース アカウントの優先順位設定の詳細については、「 [データベース メール プロファイルの作成](../../relational-databases/database-mail/create-a-database-mail-profile.md)」を参照してください。  
  
 **[上へ移動]** ボタンと **[下へ移動]** ボタンを使用して、データベース メール アカウントを使用する順序を変更できます。 順序は、シーケンス番号と呼ばれる値によって決まります。 **[上へ移動]** ではシーケンス番号が小さくなり、 **[下へ移動]** ではシーケンス番号が大きくなります。 シーケンス番号によって、データベース メールではプロファイル内のアカウントがどの順番で使用されるかが決まります。 新しい電子メール メッセージの場合、データベース メールでは、一番小さなシーケンス番号の付いたアカウントから処理が開始されます。 そのアカウントが失敗すると、データベース メールでは、このアカウントよりも大きいシーケンス番号を持つアカウントに処理が移ります。このように、データベース メールによってメッセージが正常に送信されるか、一番大きなシーケンス番号のアカウントが失敗するまで順に処理されます。 一番大きいシーケンス番号のアカウントで失敗した場合は、データベース メールの **AccountRetryDelay** パラメーターで設定された時間が経過するまで、メール送信の試行が一時停止されます。その後、一番小さいシーケンス番号のアカウントからメール送信が再試行されます。 データベース メールの **AccountRetryAttempts** パラメーターを設定し、外部メール プロセスで指定のプロファイルの各アカウントを使用して、電子メール メッセージを送信する場合の試行回数を構成します。 データベース メール構成ウィザードの **[システム パラメーターの構成]** ページで、 **AccountRetryDelay** パラメーターおよび **AccountRetryAttempts** パラメーターを構成できます。  
  
 [**プロファイル名**]  
 新しいプロファイルの名前を入力します。 プロファイルはこの名前を使用して作成されます。 既存のプロファイルの名前を使用しないでください。  
  
 **説明**  
 プロファイルの説明を入力します。 説明は省略できます。  
  
 **[SMTP アカウント]**  
 プロファイルのアカウントを 1 つ以上選択します。 データベースがアカウントを使用する順序は、優先度に応じて設定します。 アカウントが一覧表示されない場合は、 **[追加]** をクリックして新しい SMTP アカウントを追加します。  
  
 **追加**  
 アカウントをプロファイルに追加します。  
  
 **Remove**  
 選択されたアカウントをプロファイルから削除します。  
  
 **[上へ移動]**  
 選択されたアカウントの優先順位を上げます。  
  
 **[下へ移動]**  
 選択されたアカウントの優先順位を下げます。  
  
 [データベース メール構成ウィザードの使用](#DBWizard)  
  
###  <a name="manage-existing-profile-page"></a><a name="ExistingProfile"></a> [既存のプロファイルの管理] ページ  
 このページを使用すると、既存のデータベース メール プロファイルを管理できます。 データベース メール プロファイルは、データベース メール アカウントのコレクションです。 プロファイルは、電子メール サーバーが到達不能になった場合に、代わりのデータベース メール アカウントを提供することにより、信頼性を向上させます。 少なくとも 1 つのデータベース メール アカウントが必要です。 プロファイルのデータベース アカウントの優先順位設定の詳細については、「 [データベース メール プロファイルの作成](../../relational-databases/database-mail/create-a-database-mail-profile.md)」を参照してください。  
  
 **[上へ移動]** ボタンと **[下へ移動]** ボタンを使用して、データベース メール アカウントを使用する順序を変更できます。 順序は、シーケンス番号と呼ばれる値によって決まります。 **[上へ移動]** ではシーケンス番号が小さくなり、 **[下へ移動]** ではシーケンス番号が大きくなります。 シーケンス番号によって、データベース メールではプロファイル内のアカウントがどの順番で使用されるかが決まります。 新しい電子メール メッセージの場合、データベース メールでは、一番小さなシーケンス番号の付いたアカウントから処理が開始されます。 そのアカウントが失敗すると、データベース メールでは、このアカウントよりも大きいシーケンス番号を持つアカウントに処理が移ります。このように、データベース メールによってメッセージが正常に送信されるか、一番大きなシーケンス番号のアカウントが失敗するまで順に処理されます。 一番大きいシーケンス番号のアカウントで失敗した場合は、データベース メールの **AccountRetryDelay** パラメーターで設定された時間が経過するまで、メール送信の試行が一時停止されます。その後、一番小さいシーケンス番号のアカウントからメール送信が再試行されます。 データベース メールの **AccountRetryAttempts** パラメーターを設定し、外部メール プロセスで指定のプロファイルの各アカウントを使用して、電子メール メッセージを送信する場合の試行回数を構成します。 データベース メール構成ウィザードの **[システム パラメーターの構成]** ページで、 **AccountRetryDelay** パラメーターおよび **AccountRetryAttempts** パラメーターを構成できます。  
  
 [**プロファイル名**]  
 管理するプロファイルの名前を選択します。  
  
 **削除**  
 選択されているプロファイルを削除します。 確認のメッセージが表示されます。選択したプロファイルを削除し、未送信のメッセージを破棄する場合は **[はい]** を選択します。未送信のメッセージがないときのみ、選択したプロファイルを削除する場合は **[いいえ]** を選択します。  
  
 **説明**  
 選択されているプロファイルの説明を表示または変更します。 説明は省略できます。  
  
 **[SMTP アカウント]**  
 プロファイルのアカウントを 1 つ以上選択します。 フェールオーバーが発生したときにデータベース メールがアカウントを使用する順序は、フェールオーバー優先度に応じて設定されます。  
  
 **追加**  
 アカウントをプロファイルに追加します。  
  
 **Remove**  
 選択されたアカウントをプロファイルから削除します。  
  
 **[上へ移動]**  
 選択されたアカウントのフェールオーバー優先度を上げます。  
  
 **[下へ移動]**  
 選択されたアカウントのフェールオーバー優先度を下げます。  
  
 **優先順位**  
 アカウントの現在のフェールオーバー優先度を表示します。  
  
 **アカウント名**  
 アカウントの名前を表示します。  
  
 **E-mail Address**  
 アカウントの電子メール アドレスを表示します。  
  
 [データベース メール構成ウィザードの使用](#DBWizard)  
  
###  <a name="add-account-to-profile-page"></a><a name="AddAccount"></a> Add Account to Profile Page  
 このページを使用すると、プロファイルに追加するアカウントを選択できます。 既存のアカウントを **[アカウント名]** ボックスから選択するか、 **[新しいアカウント]** をクリックします。  
  
 **アカウント名**  
 プロファイルに追加するアカウントの名前を選択します。  
  
 **[電子メール アドレス]**  
 選択されたアカウントの電子メール アドレスを表示します。 このページでは、電子メール アドレスを変更できません。 アカウントの電子メール アドレスを変更するには、ウィザードのメイン ページに戻り、 **[データベース メール アカウントおよびプロファイルを管理する]** オプションをオンにしてください。  
  
 **サーバー名**  
 選択されたアカウントのメール サーバー名を表示します。 このページでは、サーバー名を変更できません。 アカウントのサーバー名を変更するには、ウィザードのメイン ページに戻り、 **[データベース メール アカウントおよびプロファイルを管理する]** オプションをオンにしてください。  
  
 **[新しいアカウント]**  
 新しいアカウントを作成します。  
  
 [データベース メール構成ウィザードの使用](#DBWizard)  
  
###  <a name="manage-accounts-and-profiles-page"></a><a name="AccountsProfiles"></a> [プロファイルとアカウントの管理] ページ  
 このページを使用すると、プロファイルまたはアカウントを管理するためのタスクを選択できます。  
  
 **新しいアカウントを作成する**  
 新しいアカウントを作成します。  
  
 **[既存のアカウントを表示、変更、または削除する]**  
 既存のアカウントを管理または削除します。  
  
 **[新しいプロファイルを作成する]**  
 新しいプロファイルを作成します。  
  
 **[既存のプロファイルを表示、変更、または削除する] プロファイルに関連付けられたアカウントを管理することもできます。**  
 既存のプロファイルを更新または削除します。 このオプションにより、プロファイルに関連付けられたアカウントを管理することもできます。  
  
 [データベース メール構成ウィザードの使用](#DBWizard)  
  
###  <a name="manage-profile-security-public-tab"></a><a name="ProfileSecurityPublic"></a> [プロファイル セキュリティの管理]、[パブリック プロファイル] タブ  
 このページを使用して、パブリック プロファイルを構成します。  
  
 プロファイルには、パブリックとプライベートの 2 種類があります。 プライベート プロファイルは、特定のユーザーまたはロールのみがアクセスできます。 パブリック プロファイルは、メール ホスト データベース (**msdb**) にアクセスできる任意のユーザーまたはロールが、電子メールを送信するときに使用できます。  
  
 任意のプロファイルを既定のプロファイルとして指定できます。 それにより、ユーザーまたはロールは、プロファイルを明示的に指定しなくても、既定のプロファイルを使用して電子メールを送信できます。 電子メール メッセージを送信するユーザーまたはロールに既定のプライベート プロファイルがある場合、データベース メールではそのプロファイルが使用されます。 ユーザーまたはロールに既定のプライベート プロファイルがない場合、 **sp_send_dbmail** では、 **msdb** データベースの既定のパブリック プロファイルが使用されます。 ユーザーまたはロールに既定のプライベート プロファイルがなく、データベースに既定のパブリック プロファイルもない場合、 **sp_send_dbmail** はエラーを返します。 既定のプロファイルとして指定できるプロファイルは 1 つだけです。  
  
 **パブリック**  
 このオプションを選択すると、指定したプロファイルがパブリック プロファイルになります。  
  
 **[プロファイル名]**  
 プロファイルの名前が表示されます。  
  
 **[既定のプロファイル]**  
 このオプションを選択すると、指定したプロファイルが既定のプロファイルになります。  
  
 **[既存のパブリック プロファイルのみを表示する]**  
 このオプションを選択すると、指定したデータベース内のパブリック プロファイルのみが表示されます。  
  
 [データベース メール構成ウィザードの使用](#DBWizard)  
  
###  <a name="manage-profile-security-private-tab"></a><a name="ProfileSecurityPrivate"></a> [プロファイル セキュリティの管理]、[プライベート プロファイル] タブ  
 このページを使用して、プライベート プロファイルを構成します。  
  
 プロファイルには、パブリックとプライベートの 2 種類があります。 プライベート プロファイルは、特定のユーザーまたはロールのみがアクセスできます。 パブリック プロファイルは、メール ホスト データベース (**msdb**) にアクセスできる任意のユーザーまたはロールが、電子メールを送信するときに使用できます。  
  
 任意のプロファイルを既定のプロファイルとして指定できます。 それにより、ユーザーまたはロールは、プロファイルを明示的に指定しなくても、既定のプロファイルを使用して電子メールを送信できます。 電子メール メッセージを送信するユーザーまたはロールに既定のプライベート プロファイルがある場合、データベース メールではそのプロファイルが使用されます。 ユーザーまたはロールに既定のプライベート プロファイルがない場合、 **sp_send_dbmail** では、 **msdb** データベースの既定のパブリック プロファイルが使用されます。 ユーザーまたはロールに既定のプライベート プロファイルがなく、データベースに既定のパブリック プロファイルもない場合、 **sp_send_dbmail** はエラーを返します。  
  
 **ユーザー名**  
 **msdb** データベース内のユーザーまたはロールの名前を選択します。  
  
 **Access (アクセス)**  
 ユーザーまたはロールが指定されたプロファイルにアクセスできるかどうかを選択します。  
  
 [**プロファイル名**]  
 プロファイルの名前が表示されます。  
  
 **[既定のプロファイル]**  
 このプロファイルがユーザーまたはロールの既定のプロファイルかどうかを選択します。 各ユーザーまたはロールには、既定のプロファイルを 1 つだけ指定できます。  
  
 **[このユーザーの既存のプライベート プロファイルのみを表示する]**  
 オンにすると、指定されたユーザーまたはロールが既にアクセスを許可されているプロファイルのみが表示されます。  
  
 [データベース メール構成ウィザードの使用](#DBWizard)  
  
###  <a name="configure-system-parameters"></a><a name="SystemParameters"></a> AccountRetryAttempts  
 このページを使用して、データベース メールのシステム パラメーターを指定します。 システム パラメーターの一覧および各パラメーターの現在の値が表示されます。 パラメーターを選択すると、簡単な説明が情報ペインに表示されます。  
  
 **[アカウントの再試行回数]**  
 指定したプロファイル内の各アカウントを使用して、外部メール処理が電子メール メッセージの送信を試行する回数。  
  
 **[アカウントの再試行間隔 (秒)]**  
 外部メール プロセスが、プロファイルのすべてのアカウントを使用してメッセージ配信を試行した後で、再度すべてのアカウントによって試行するまで待機する時間 (秒数)。  
  
 **[ファイルの最大ファイル サイズ (バイト数)]**  
 添付ファイルの最大サイズ (バイト単位)。  
  
 **[禁止する添付ファイルの拡張子]**  
 電子メールへの添付ファイルとして送信できない拡張子のコンマ区切りのリスト。 **[...]** ボタンをクリックして新たに拡張子を追加できます。  
  
 **[データベース メール実行可能ファイルの最短有効期間 (秒)]**  
 外部メール処理がアクティブな状態にとどまる最小時間 (秒単位)。 電子メールがデータベース メール キューに入っている間は、プロセスはアクティブな状態のままです。 このパラメーターは、処理するメッセージがない場合にプロセスがアクティブな状態を維持する秒数を指定します。  
  
 **ログ記録レベル**  
 データベース メール ログに記録されるメッセージ。 次のいずれかの値になります。  
  
-   [標準] - エラーのみを記録します。  
  
-   [拡張] - エラー、警告、および情報メッセージを記録します。  
  
-   [詳細] - エラー、警告、情報メッセージ、成功メッセージ、および追加情報メッセージを記録します。 詳細ログ記録はトラブルシューティングに使用します。  
  
 既定値は [拡張] です。  
  
 **[すべてリセット]**  
 このオプションを選択すると、ページ上の値が既定値にリセットされます。  
  
 [データベース メール構成ウィザードの使用](#DBWizard)  
  
###  <a name="complete-the-wizard-page"></a><a name="CompleteWizard"></a> [ウィザードの完了] ページ  
 このページを使用すると、 **データベース メール構成ウィザード** によって実行されるアクションを確認できます。 ウィザードを完了するまでは、変更を加えることはできません。  
  
 [データベース メール構成ウィザードの使用](#DBWizard)  
  
###  <a name="send-test-e-mail-page"></a><a name="TestEmail"></a> Send Test E-Mail Page  
 **[ _<インスタンス名>_ からテスト電子メールを送信]** ページでは、指定したデータベース メール プロファイルを使用して電子メール メッセージを送信できます。 このページを使用してテスト電子メールを送信できるのは、固定サーバー ロール **sysadmin** のメンバーのみです。  
  
 **[データベース メール プロファイル]**  
 データベース メール プロファイルを一覧から選択します。 これは必須フィールドです。 プロファイルが 1 つも表示されない場合は、プロファイルがないか、またはプロファイルに対する権限がありません。 プロファイルの作成および構成には、 **データベース メール構成ウィザード** を使用します。 プロファイルが表示されない場合は、データベース メール構成ウィザードを使用して、使用するプロファイルを作成してください。  
  
 **To**  
 メッセージの受信者の電子メール アドレス。 少なくとも 1 人の受信者を指定する必要があります。  
  
 **件名**  
 テスト電子メールの件名行。 トラブルシューティングの内容に合わせて、既定の件名を変更します。  
  
 **本文**  
 テスト電子メールの本文。 トラブルシューティングの内容に合わせて、既定の件名を変更します。  
  
 **[データベース メールのテスト電子メール]** ダイアログ ボックスでは、データベース メールがテスト メッセージの送信を試みたことが通知され、テスト電子メール メッセージの **mailitem_id** が表示されます。 電子メールが到着したかどうか受信者に確認します。 通常、電子メールは数分以内に受信されますが、ネットワークのパフォーマンスが低速である場合や、メール サーバーにメッセージのバックログがある場合、またはサーバーが一時的に使用できない場合には、電子メールの到着が遅れることもあります。 **mailitem_id** はトラブルシューティングに使用します。  
  
 **[送信された電子メール]**  
 テスト電子メール メッセージの **mailitem_id** 。  
  
 **[トラブルシューティング]**  
 クリックすると、オンライン ブックのトピック「 [データベース メールのトラブルシューティング](/previous-versions/sql/sql-server-2008-r2/ms188663(v=sql.105))」が開きます。  
  
 [データベース メール構成ウィザードの使用](#DBWizard)  
  
##  <a name="using-templates"></a><a name="Template"></a> テンプレートの使用  
 **データベース メール構成スクリプトを作成するには**  
  
1.  **[表示]** メニューの **[テンプレート エクスプローラー]** をクリックします。  
  
2.  **[テンプレート エクスプローラー]** ウィンドウで、 **[Database Mail]** フォルダーを展開します。  
  
3.  **[Simple Database Mail Configuration]** をダブルクリックします。 テンプレートが新しいクエリ ウィンドウに開きます。  
  
4.  **[クエリ]** メニューの **[テンプレート パラメーターの値の指定]** をクリックします。 **[テンプレート パラメーターの値の指定]** ウィンドウが開きます。  
  
5.  **profile_name**、 **account_name**、 **SMTP_servername**、 **email_address**、および **display_name** の値を入力します。 SQL Server Management Studio によって、テンプレートに入力値が書き込まれます。  
  
6.  スクリプトを実行して構成を行います。  
  
7.  このスクリプトでは、どのデータベース ユーザーにもこのプロファイルにアクセスする権限が与えられません。 そのため、既定では、プロファイルを使用できるのは **sysadmin** 固定セキュリティ ロールのメンバーだけです。 プロファイルへのアクセスを許可する方法の詳細については、「[sysmail_add_principalprofile_sp &#40;Transact-SQL&#41;](../../relational-databases/system-stored-procedures/sysmail-add-principalprofile-sp-transact-sql.md)」を参照してください。  
  
