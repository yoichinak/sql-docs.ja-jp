---
title: ステージングデータベースの使用
description: SQL Server 並列データウェアハウス (PDW) では、ステージングデータベースを使用して、読み込み処理中にデータを一時的に格納します。
author: mzaman1
ms.prod: sql
ms.technology: data-warehouse
ms.topic: conceptual
ms.date: 04/17/2018
ms.author: murshedz
ms.reviewer: martinle
ms.custom: seo-dt-2019
ms.openlocfilehash: dcd7f95833695cc5f9f791d83a6221c35e88f58e
ms.sourcegitcommit: 33e774fbf48a432485c601541840905c21f613a0
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/25/2020
ms.locfileid: "74400285"
---
# <a name="using-a-staging-database-in-parallel-data-warehouse-pdw"></a>並列データウェアハウスでのステージングデータベースの使用 (PDW)
SQL Server 並列データウェアハウス (PDW) では、ステージングデータベースを使用して、読み込み処理中にデータを一時的に格納します。 既定では、SQL Server PDW は転送先データベースをステージングデータベースとして使用するため、テーブルの断片化が発生する可能性があります。 テーブルの断片化を減らすために、ユーザー定義のステージングデータベースを作成できます。 または、読み込みエラーからのロールバックが問題にならない場合は、一時テーブルをスキップして変換先テーブルに直接読み込むことで、fastappend 読み込みモードを使用してパフォーマンスを向上させることができます。  
  
## <a name="staging-database-basics"></a><a name="StagingDatabase"></a>ステージングデータベースの基礎  
*ステージングデータベース*は、ユーザーが作成した PDW データベースであり、アプライアンスへの読み込み中にデータを一時的に保存します。 負荷にステージングデータベースが指定されている場合、アプライアンスはまずデータをステージングデータベースにコピーし、次にステージングデータベースの一時テーブルからコピー先のデータベースのパーマネントテーブルにデータをコピーします。  
  
ロードにステージングデータベースが指定されていない場合、SQL ServerPDW は、読み込まれたデータをパーマネントコピー先テーブルに挿入する前に、コピー先データベースに一時テーブルを作成し、読み込まれたデータを格納するために使用します。  
  
読み込みで *fastappend モード*が使用されている場合、SQL serverpdw は一時テーブルを完全に使用しないようにして、データを直接ターゲットテーブルに追加します。 Fastappend モードでは、アプリケーションの観点から一時テーブルにデータが読み込まれる ELT シナリオの読み込みパフォーマンスが向上します。 たとえば、ELT プロセスは、データを一時テーブルに読み込み、クレンジングと重複除去によってデータを処理してから、対象のファクトテーブルにデータを挿入することができます。 この場合、PDW がデータをアプリケーションの一時テーブルに挿入する前に、最初にデータを内部一時テーブルに読み込む必要はありません。 Fastappend モードでは、余分な読み込み手順が回避されるため、読み込みのパフォーマンスが大幅に向上します。 Fastappend モードを使用するには、マルチトランザクションモードを使用する必要があります。これは、失敗または中止された負荷からの復旧を独自の読み込みプロセスで処理する必要があることを意味します。  
  
**ステージングデータベースの利点**  
  
ステージングデータベースの主な利点は、テーブルの断片化を減らすことです。 ステージングデータベースが使用されていない場合、データはコピー先データベースの一時テーブルに読み込まれます。 一時テーブルが作成され、コピー先のデータベースに削除されると、一時テーブルとパーマネントテーブルのページがインターリーブされます。 時間の経過と共に、テーブルの断片化が発生し、パフォーマンスが低下します。 これに対し、ステージングデータベースでは、一時テーブルが永続的なテーブルとは別のファイル領域に作成され、削除されることが保証されます。  
  
**ステージングデータベースのテーブル構造**  
  
各データベーステーブルのストレージ構造は、変換先テーブルによって異なります。  
  
-   ヒープまたはクラスター化列ストアインデックスへの読み込みでは、ステージングテーブルがヒープになります。  
  
-   行ストアクラスター化インデックスへの読み込みでは、ステージングテーブルは行ストアクラスター化インデックスです。  
  
## <a name="permissions"></a><a name="Permissions"></a>アクセス許可  
ステージングデータベースに CREATE 権限 (一時テーブルを作成する場合) が必要です。 

<!-- MISSING LINKS

For more information, see [Grant Permissions to load data](grant-permissions-to-load-data.md).  

-->
  
## <a name="best-practices-for-creating-a-staging-database"></a><a name="CreatingStagingDatabase"></a>ステージングデータベースを作成するためのベストプラクティス  
  
1.  アプライアンスごとにステージングデータベースは1つだけ存在します。 ステージングデータベースは、すべての転送先データベースのすべてのロードジョブで共有できます。  
  
2.  ステージングデータベースのサイズは顧客固有です。 最初にアプライアンスにデータを入力するときは、最初の読み込みジョブを格納するのに十分な大きさのステージングデータベースが必要です。 これらの負荷ジョブは、複数の負荷が同時に発生する可能性があるため、大きくなる傾向があります。 初期読み込みジョブが完了し、システムが運用環境にある場合、各読み込みジョブのサイズは小さくなる可能性があります。 負荷が小さい場合は、ステージングデータベースのサイズを小さくして、小さい負荷サイズに対応させることができます。 サイズを小さくするには、ステージングデータベースを削除し、サイズの小さい割り当てでもう一度作成します。または、 [ALTER database](../t-sql/statements/alter-database-transact-sql.md?tabs=sqlpdw) ステートメントを使用することもできます。  
  
    ステージングデータベースの作成時には、次のガイドラインに従ってください。  
  
    -   レプリケートされたテーブルのサイズは、同時に読み込まれるすべてのレプリケートされたテーブルの推定サイズ (コンピューティングノード単位) である必要があります。 通常、サイズは 25-30 GB です。  
  
    -   分散テーブルのサイズは、同時に読み込まれるすべての分散テーブルの推定サイズ (アプライアンス単位) である必要があります。  
  
    -   ログサイズは、通常、レプリケートされたテーブルのサイズに似ています。  
  
## <a name="examples"></a><a name="Examples"></a>例  
  
### <a name="a-create-a-staging-database"></a>A. ステージングデータベースの作成 
次の例では、アプライアンス上のすべての負荷で使用するステージングデータベース Stagedb を作成します。 5 GB のサイズのレプリケートされたテーブルがそれぞれ同時に読み込まれることを推定したとします。 この同時実行では、レプリケートされたサイズに対して 25 GB 以上が割り当てられます。 サイズが100、200、400、500、500、および 550 GB の6つの分散テーブルが同時に読み込まれることを推定したとします。 この同時実行の結果、分散テーブルサイズに 2250 GB 以上が割り当てられます。  
  
```sql  
CREATE DATABASE Stagedb  
WITH (  
  
    AUTOGROW = ON,  
  
    REPLICATED_SIZE = 25 GB,  
  
    DISTRIBUTED_SIZE = 2250 GB,  
  
    LOG_SIZE = 25 GB  
  
);  
```  

<!-- MISSING LINKS
 
## See Also  
[Common metadata query examples](metadata-query-examples.md)  

-->
  
