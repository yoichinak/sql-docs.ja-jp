---
title: Jupyter ノートブックと Azure Data Studio を使用したビッグ データ クラスター (BDC) のトラブルシューティング
titleSuffix: SQL Server Big Data Clusters
description: SQL Server 2019 ビッグ データ クラスター上での Jupyter ノートブックと Azure Data Studio を使用した BDC のトラブルシューティング。
author: cloudmelon
ms.author: melqin
ms.reviewer: mikeray
ms.metadata: seo-lt-2019
ms.date: 09/22/2020
ms.topic: conceptual
ms.prod: sql
ms.technology: big-data-cluster
ms.openlocfilehash: 51286acc7f963b8d680bd81121cc22bab1c1a0a6
ms.sourcegitcommit: b3a711a673baebb2ff10d7142b209982b46973ae
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 11/05/2020
ms.locfileid: "93364384"
---
# <a name="troubleshooting-big-data-clusters-bdc-with-notebooks"></a>ノートブックを使用したビッグ データクラスター (BDC) のトラブルシューティング

このページは、SQL Server ビッグ データ クラスター用のノートブックのインデックスです。 これらの実行可能ノートブック (.ipynb) は、ビッグ データ クラスターのトラブルシューティングに役立つように SQL Server 2019 向けに設計されています。

各ノートブックは、独自の依存関係を確認するように設計されています。 **[Run all cells]\(すべてのセルを実行\)** を使用すると、正常に完了するか、例外が発生し、欠落している依存関係を解決するための別のノートブックにハイパーリンクされたヒントが示されます。 後続のノートブックへのヒント ハイパーリンクに従い、 **[Run all cells]\(すべてのセルを実行\)** をクリックし、成功した場合は元のノートブックに戻り、 **[Run all cells]\(すべてのセルを実行\)** をクリックします。

すべての依存関係がインストールされていても、 **[Run all cells]\(すべてのセルを実行\)** に失敗した場合は、各ノートブックを使用して結果を分析し、可能であれば、問題の解決にさらに役立つように別のノートブックにハイパーリンクされたヒントを生成します。


## <a name="troubleshooting-big-data-cluster-bdc"></a>ビッグ データ クラスター (BDC) のトラブルシューティング

このセクションには、SQL Server ビッグ データ クラスター(BDC) からのログ取得のための一連のノートブックが含まれています。

|名前 |説明 |
|---|---|---|---|
|TSG100 - ビッグ データ クラスターのトラブルシューティング ツール|ビッグ データ クラスター (BDC) に関する問題のトラブルシューティングで使用可能なすべてのノートブックの概要と、どのような場合にそれらを使用するか  |
|TSG101 - SQL Server のトラブルシューティング ツール|SQL Server に関する問題のトラブルシューティングで使用可能なすべてのノートブックの概要と、どのような場合にそれらを使用するか  |
|TSG102 - HDFS トラブルシューティング ツール|HDFS に関する問題のトラブルシューティングで使用可能なすべてのノートブックの概要と、どのような場合にそれらを使用するか  |
|TSG103 - Spark のトラブルシューティング ツール|Spark に関する問題のトラブルシューティングで使用可能なすべてのノートブックの概要と、どのような場合にそれらを使用するか  |
|TSG104 - コントロールのトラブルシューティング ツール|コントローラーに関する問題のトラブルシューティングで使用可能なすべてのノートブックの概要と、どのような場合にそれらを使用するか  |
|TSG105 - ゲートウェイのトラブルシューティング ツール|Knox ゲートウェイに関する問題のトラブルシューティングで使用可能なすべてのノートブックの概要と、どのような場合にそれらを使用するか  |
|TSG106 - アプリのトラブルシューティング ツール|App-Deploy に関する問題のトラブルシューティングで使用可能なすべてのノートブックの概要と、どのような場合にそれらを使用するか  |



## <a name="diagnose-issues-from-big-data-clusters-bdc"></a>ビッグ データ クラスター (BDC) の問題の診断

ビッグ データ クラスターでの状況と状態を診断するための一連のノートブック。

|名前 |説明 |
|---|---|---|---|
|TSG002 - CrashLoopBackoff|この TSG を使用して、"実行中" 状態に推移する最後の試行が失敗した各コンテナーに接続し、現在と以前のコンテナー ログを取得します。 これは、kubectl get pods で報告された CrashLoopBackOff の問題をデバッグする場合に便利です。|
|TSG025 - FSM ブラウザー - クエリ コントローラー FSM の状態|このノートブックを使用してコントローラー データベースに接続し、Finite State Machine (FSM) の状態を参照します。 このノートブックを使用して、アクティブな状態のコンピューターを一覧表示し、停止しているワークフローを特定します。|
|TSG026 - データ プール ノードに接続する (T-SQL を実行する)|このノートブックを使用してデータ プール ノードに接続 (T-SQL を実行) します。|
|TSG027 - クラスターのデプロイを観察する|このノートブックを使用してクラスターのデプロイを観察します。これにより、SQL Server ビッグ データ クラスターの作成に関する問題のトラブルシューティングを行うためのガイダンスが提供されます。基になる原因を特定するのに次のコマンドが役に立つことがよくあります。 |
|TSG029 - クラスター内のダンプを検索する|このノートブックを使用して、ビッグ データ クラスター内の SQL Server やコントローラーなどのプロセスからのコアダンプとミニダンプを検索します。|
|TSG032 - すべてのコンテナーの CPU とメモリの使用状況|このノートブックを使用して、すべてのコンテナーの CPU とメモリの使用状況を確認します。|
|TSG037 - プライマリ レプリカをホストしているマスター プール ポッドを特定する|このノートブックを使用して、マスター プールの高可用性が有効になっている場合に、ビッグ データ クラスターのプライマリ レプリカをホストしているマスター プール ポッドを特定します。|
|TSG044 - マスター プール コンテナーで sqlcmd を実行する|このノートブックを使用して、T-SQL 経由で直接マスター プール ノードに接続します。|
|TSG055 - sparkhead への time curl|このノートブックを使用して、コントローラー ポッドから sparkhead ポッドまでの curl 応答時間がどれぐらいかを把握するためにステップを診断します。|
|TSG060 - すべての BDC PVC 用の永続ボリューム ディスク領域|このノートブックを使用して各コンテナーに接続し、ビッグ データ クラスター (BDC) の各永続ボリューム要求 (PVC) にマップされている各永続化ボリューム (PV) に対して、使用されているディスク領域と使用可能なディスク領域を取得します。|
|TSG078 - クラスターが正常であるかどうか|このノートブックを使用して、ビッグ データ クラスター (BDC) が正常であるかどうかを確認します。|
|TSG079 - コントローラー コア ダンプを生成する|このノートブックを使用してコントローラー コア ダンプを生成します。|
|TSG086 - すべてのコンテナーで top を実行する|このノートブックを使用して、すべてのコンテナーで top を実行します。|
|TSG087 - namenode ポッドで hadoop fs CLI を使用する|このノートブックを使用して、namenode ポッドで hadoop fs CLI を使用します。|
|TSG108 - コントローラーのアップグレード構成マップを表示する|このノートブックを使用して、 **azdata bdc upgrade** を使ってビッグ データ クラスターのアップグレードを実行するときのエラーのトラブルシューティングを行います。|
|TSG112 - Active Directory デプロイ前チェック|このノートブックを使用して、Active Directory (AD) デプロイに対して、ビッグ データ クラスター (BDC) の構成が有効であることを検証します。|
|TSG115 - SQL Server on Linux セキュリティ ログ変換ツール|このノートブックを使用して、SQL Server on Linux の secuirty.ldap および security.kerberos ロガーによって生成されたログを解析します。 これらのロガーを有効にするには、SQL Server on Linux を実行しているコンピューター上の /var/opt/mssql/logger.ini に次の行を配置します。 注: このファイルは大文字と小文字が区別されます。|
|TSG116 - SQL BDC セキュリティ サポート ログ変換ツール|このノートブックを使用して、SQL BDC のセキュリティ サポート サービスによって生成されたログを解析します。 ログを取得するには、クラスターからデバッグ ログをコピーして抽出します。 手順は次のとおりです。"azdata bdc debug copy-logs -n <namespace> *" を実行します。これにより、いくつかの .tar.gz ファイルが作成されます。debuglogs-* <namespace>-<date>-<time>.tar.gz の内容を抽出します。./<namespace>/control-<…>/security-support/supervisol/log/secsupp-stderr---<…>.log に格納されているセキュリティ サポート ログを確認します。|
|TSG119 - Active Directory デプロイ後チェック|このノートブックは、AD デプロイ後の BDC 構成の検証用に設計されています。 これにより、dnsName 属性を持つすべてのエンドポイントについて、DNS エントリが存在することを確認します。これらの DNS エントリは、エイリアスではなくホスト レコード (つまり、CNAME レコードではなく A レコード) である必要があります。また、既知の AD アカウントが存在すること、それらが有効になっているかどうか、および想定される SPN が存在することも確認します。|






## <a name="repair-issues-from-big-data-clusters-bdc"></a>ビッグ データ クラスター (BDC) の問題を修復する

SQL Server ビッグ データ クラスターの既知の状況と状態を修復するための一連のノートブック。

|名前 |説明 |
|---|---|---|---|
|TSG005 - 転送ループが検出された|ユーティリティ dnsmasq によって resolv.conf 内にローカル ループバックを設定できます。これにより、初期クラスターのデプロイ中にコントローラー ポッドが CrashLoopBackOff になる可能性があります。そこで検出された転送ループを処理するために、このノートブックを使用します: https://askubuntu.com/questions/627899/nameserver-127-0-1-1-in-resolv-conf-wont-go-away|
|TSG011 - sparkhistory サーバーを再起動する|このノートブックを使用して、sparkhistory サーバーを再起動します (sparkhistory java プロセスが起動中に応答を停止するおそれがあるため)。 sparkhistory サーバーの再起動 (supervisorctl restart sparkhistory) を実行することで、この問題を解決できる場合があります。|
|TSG018 - マスター プールで sqlservr プロセスを強制終了する| このノートブックは、T-SQL の SHUTDOWN で ./sqlservr プロセスが正常にリサイクルされない場合に使用します。 このノートブックを使用してメインの sqlservr プロセスを強制終了すると、それは ./sqlservr フロントエンド プロセスによって自動的に再起動されます。|
|TSG024 - Namenode がセーフ モードである| このノートブックは、HDFS がセーフ モードになった場合に使用します。 たとえば、記憶域プールであまりにも多くのポッドがあまりにも速くリサイクルされた場合、セーフ モードが自動的に有効になることがあります。|
|TSG028 - すべての記憶域プール ノード上でノード マネージャーを再起動する| このノートブックは、すべての記憶域プール ノードでノード マネージャーを再起動する必要がある場合に使用します。|
|TSG038 - ドキュメントにキーがないため BDC の作成が失敗する| このノートブックは、ドキュメントにキーがないことが原因で BDC の作成が失敗した場合に使用します。|
|TSG039 - オブジェクト名 'role_permissions' が無効| このノートブックは、Knox gateway.log のロール アクセス許可が原因でオブジェクトが無効という問題が発生した場合に使用します。|
|TSG040 - コントローラーからのファイル名の取得に失敗し、エラーが発生しました| このノートブックは、コントローラーからファイル名を取得しているときに 504 ゲートウェイのタイムアウトが発生した場合に使用します。|
|TSG041 - 新しい非同期 I/O コンテキストを作成できません (sysctl fs.aio-max-nr を増やす)| このノートブックは、新しい非同期 I/O コンテキストを作成できない (sysctl fs.aio-max-nr を増やす) 場合に使用します。|
|TSG045 - このサイズの VM にアタッチできる最大データ ディスク数 (AKS)| このノートブックは、このサイズの VM にアタッチできる最大データ ディスク数 (AKS) の場合に使用します。|
|TSG047 - ConfigException - 名前を持つオブジェクトが 1 つだけ必要です| このノートブックは、名前を持つオブジェクトが 1 つだけであることを想定した ConfigException が発生した場合に使用します。|
|TSG048 - "コントローラー ポッドが起動するのを待機しています" でデプロイが停止する| このノートブックは、"コントローラー ポッドが起動するのを待機しています" でデプロイが停止した場合に使用します。|
|TSG050 - "ボリュームがポッドにアタッチまたはマウントする待機中にタイムアウトしました" という状態でクラスターがハングします| このノートブックは、"ボリュームがポッドにアタッチまたはマウントする待機中にタイムアウトしました" という状態でクラスターがハングした場合に使用します。|
|TSG052 - master-svc DNS を取得できなかったため、もう一度試行します| このノートブックは、"ボリュームがポッドにアタッチまたはマウントする待機中にタイムアウトしました" という状態でクラスターがハングした場合に使用します。|
|TSG057 - コントローラー サービスの開始時にエラーが発生しました。System.TimeoutException| このノートブックは、コントローラー サービスの開始時に System.TimeoutException が返される場合に使用します。|
|TSG067 - Kube 構成の設定を完了できませんでした| このノートブックは、Kube 構成の設定を完了できない場合に使用します。|
|TSG074 - App-Deploy を削除する| このノートブックは、BDC クラスター内のアプリを削除する際に問題が発生した場合に使用します。|
|TSG075 - NetworkPlugin cni でポッドを設定できなかったことによる FailedCreatePodSandBox| このノートブックは、NetworkPlugin cni でポッドを設定できなかったことが原因で FailedCreatePodSandBox 例外が発生している場合に使用します。|
|TSG080 - azdata を使用して Spark セッションを削除する| このノートブックは、Spark セッションの削除中に問題が発生した場合に使用します。|
|TSG109 - アップグレードのタイムアウトを設定する| このノートブックは、BDC のアップグレードに関する問題が発生している場合に使用します。|
|TSG110 - Azdata から ApiError が返される| このノートブックは、Azdata から ApiError が返された場合に使用します。|

## <a name="next-steps"></a>次のステップ

ビッグ データ クラスターの詳細については、[[!INCLUDE[big-data-clusters-2019](../includes/ssbigdataclusters-ss-nover.md)] とは](big-data-cluster-overview.md)の概要に関するページを参照してください。
