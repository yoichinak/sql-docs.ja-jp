---
description: Integration Services (SSIS) のクエリ
title: Integration Services (SSIS) のクエリ | Microsoft Docs
ms.custom: ''
ms.date: 03/14/2017
ms.prod: sql
ms.prod_service: integration-services
ms.reviewer: ''
ms.technology: integration-services
ms.topic: conceptual
f1_keywords:
- sql13.dts.designer.querybuilder.f1
helpviewer_keywords:
- Query Builder [Integration Services]
- queries [Integration Services]
- statements [Integration Services]
- queries [Integration Services], about queries in packages
ms.assetid: 8822bd29-4575-46c8-92a0-1a39bc2604c1
author: chugugrace
ms.author: chugu
ms.openlocfilehash: 54a577a2a94c64eafe3817ccd9a041125629f846
ms.sourcegitcommit: c5078791a07330a87a92abb19b791e950672e198
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 11/26/2020
ms.locfileid: "92193845"
---
# <a name="integration-services-ssis-queries"></a>Integration Services (SSIS) のクエリ

[!INCLUDE[sqlserver-ssis](../includes/applies-to-version/sqlserver-ssis.md)]


  SQL 実行タスク、OLE DB ソース、OLE DB 変換先、および参照変換では、SQL クエリを使用できます。 SQL 実行タスクでは、SQL ステートメントによってデータベース オブジェクトとデータを作成、更新、および削除したり、ストアド プロシージャを実行したり、SELECT ステートメントを実行したりすることができます。 OLE DB ソースと参照変換の場合、通常 SQL ステートメントは SELECT ステートメントまたは EXEC ステートメントです。 EXEC ステートメントで最もよく実行するのは、結果セットを返すストアド プロシージャです。  
  
 クエリを解析して、有効かどうかを確認できます。 [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)]への接続を使用するクエリを解析すると、クエリは解析後に実行されて、実行結果 (成功または失敗) が解析結果に割り当てられます。 [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)]以外のデータへの接続をクエリで使用する場合、ステートメントは解析されるだけです。  
  
SQL ステートメントは次の方法で提供できます。
1.   デザイナーで直接入力します。
2.   ステートメントが含まれているファイルへの接続を指定します。
3.   ステートメントを含む変数を指定します。  
  
## <a name="direct-input-sql"></a>直接入力 SQL  
 クエリ ビルダーは、SQL 実行タスク、OLE DB ソース、OLE DB 変換先、および参照変換のユーザー インターフェイスで使用できます。 クエリ ビルダーを使用すると次の利点があります。  
  
-   視覚的な作業、または SQL コマンドを使用した作業  
  
     クエリ ビルダーには、クエリを視覚的に構成するグラフィカル ペインと、クエリの SQL テキストを表示するテキスト ペインがあります。 グラフィカル ペインとテキスト ペインのどちらでも作業ができます。 これらの表示はクエリ ビルダーによって同期されるため、クエリのテキストとグラフィカルな表示は常に一致します。  
  
-   関係付けられたテーブルの結合  
  
     クエリに複数のテーブルを追加する場合、クエリ ビルダーでは自動的にテーブル間の関係を認識し、適切な結合コマンドを作成します。  
  
-   データベースのクエリまたは更新  
  
     クエリ ビルダーでは、Transact-SQL SELECT ステートメントを使用してデータを返すことができます。また、データベースのレコードの更新、追加、削除を行うクエリを作成できます。  
  
-   結果の即時の表示と変更  
  
     クエリを実行したり、グリッドのレコードセットを使用して、データベースのレコードのスクロールや編集ができます。  
  
 クエリ ビルダーの視覚的な作業で作成できるのは SELECT クエリだけですが、テキスト ペインには DELETE や UPDATE ステートメントなど他の種類の SQL ステートメントを入力できます。 入力した SQL ステートメントに合わせて、グラフィカル ペインも自動的に更新されます。  
  
 また、直接入力は、タスクやデータ フロー コンポーネントのダイアログ ボックス、またはプロパティ ウィンドウにクエリを入力しても行えます。  
  
 詳細については、「 [クエリ ビルダー]()」を参照してください。  
  
## <a name="sql-in-files"></a>ファイルの SQL  
 SQL 実行タスクの SQL ステートメントを、別のファイルに格納しておくことも可能です。 たとえば、 [!INCLUDE[ssManStudioFull](../includes/ssmanstudiofull-md.md)]のクエリ エディターのようなツールを使用してクエリを記述し、ファイルに保存して、パッケージを実行するときにファイルからクエリを読み込むことができます。 ファイルには、実行する SQL ステートメントとコメントのみを含めることができます。 ファイルに格納された SQL ステートメントを使用するには、ファイル名とファイルの場所を指定するファイル接続を用意する必要があります。 詳しくは「 [File Connection Manager](../integration-services/connection-manager/file-connection-manager.md)」をご覧ください。  
  
## <a name="sql-in-variables"></a>変数の SQL  
 SQL 実行タスクの SQL ステートメントのソースが変数の場合、クエリが格納されている変数の名前を指定します。 変数の Value プロパティにクエリのテキストを格納します。 変数の ValueType プロパティを文字列データ型に設定し、Value プロパティに SQL ステートメントを入力またはコピーします。 詳細については、「[Integration Services &#40;SSIS&#41; の変数](../integration-services/integration-services-ssis-variables.md)」と「[パッケージで変数を使用する](./integration-services-ssis-variables.md)」をご覧ください。  

## <a name="query-builder-dialog-box"></a>[クエリ ビルダー] ダイアログ ボックス
**[クエリ ビルダー]** ダイアログ ボックスを使用すると、SQL 実行タスク、OLE DB 変換元と OLE DB 変換先、および参照変換で使用するクエリを作成できます。  
  
 クエリ ビルダーを使用すると、次のタスクを実行できます。  
  
-   **クエリのグラフィカルな表現と SQL コマンドの操作** クエリ ビルダーには、クエリをグラフィカルに表示するペインと、クエリの SQL テキストを表示するペインがあります。 グラフィカル ペインとテキスト ペインのどちらでも作業ができます。 クエリ ビルダーでは、ビューの同期をとっているため、どちらにも常に最新の状態が表示されます。  
  
-   **関連テーブルの結合** クエリに複数のテーブルを追加する場合、クエリ ビルダーはテーブル間の関係を自動的に認識し、適切な結合コマンドを作成します。  
  
-   **データベースのクエリまたは更新** クエリ ビルダーでは、Transact-SQL の SELECT ステートメントを使用してデータを返すことができます。また、データベースのレコードの更新、追加、削除を行うクエリを作成できます。  
  
-   **結果の即時の表示と編集** クエリを実行し、グリッドのレコードセットを使用して、データベースのレコードをスクロールし、編集できます。  
  
 **[クエリ ビルダー]** ダイアログ ボックスのグラフィカル ツールにより、ドラッグ アンド ドロップ操作でクエリを作成できます。 既定では、[クエリ ビルダー] ダイアログ ボックスは SELECT クエリを構築しますが、INSERT、UPDATE、または DELETE クエリも作成できます。 **[クエリ ビルダー]** ダイアログ ボックスで、すべての種類の SQL ステートメントを解析して実行できます。 パッケージの SQL ステートメントの詳細については、「[Integration Services (SSIS) のクエリ](../integration-services/integration-services-ssis-queries.md)」を参照してください。  
  
 Transact-SQL 言語およびその構文の詳細については、「[Transact-SQL リファレンス (データベース エンジン)](../t-sql/language-reference.md)」を参照してください。  
  
 クエリで変数を使用して、入力パラメーターへの値の指定、出力パラメーターの値の取得、およびリターン コードの格納を行うこともできます。 パッケージで使用するクエリでの変数の使用の詳細については、「[SQL 実行タスク](../integration-services/control-flow/execute-sql-task.md)」、「[OLE DB ソース](../integration-services/data-flow/ole-db-source.md)」、および「[Integration Services (SSIS) のクエリ](../integration-services/integration-services-ssis-queries.md)」を参照してください。 SQL 実行タスクでの変数の使用の詳細については、「 [SQL 実行タスクのパラメーターとリターン コード](./control-flow/execute-sql-task.md) 」および「 [SQL 実行タスクにおける結果セット](./control-flow/execute-sql-task.md)」を参照してください。  
  
 参照変換およびあいまい参照変換でも、パラメーターとリターン コードに変数を使用できます。 OLE DB ソースに関する情報は、これら 2 つの変換にも適用されます。  
  
### <a name="options"></a>オプション  
 **ツール バー**  
 ツール バーは、データセットの管理、表示するペインの選択、クエリ機能の制御に使用します。  
  
|値|説明|  
|-----------|-----------------|  
|**[ダイアグラム ペインの表示/非表示]**|**[ダイアグラム]** ペインの表示と非表示を切り替えます。|  
|**[グリッド ペインの表示/非表示]**|**[グリッド]** ペインの表示と非表示を切り替えます。|  
|**[SQL ペインの表示/非表示]**|**[SQL]** ペインの表示と非表示を切り替えます。|  
|**[結果ペインの表示/非表示]**|**[結果]** ペインの表示と非表示を切り替えます。|  
|**実行**|クエリを実行します。 結果は結果ペインに表示されます。|  
|**[SQL の確認]**|SQL ステートメントが有効であることを確認します。|  
|**[昇順で並べ替え]**|[グリッド] ペインで選択した列の出力行を昇順で並べ替えます。|  
|**[降順で並べ替え]**|[グリッド] ペインで選択した列の出力行を降順で並べ替えます。|  
|**[フィルターの削除]**|[グリッド] ペインの列名を選択してから、 **[フィルターの削除]** をクリックして列の並べ替え条件を削除します。|  
|**[Group By の使用]**|クエリに GROUP BY 機能を追加します。|  
|**[テーブルの追加]**|新しいテーブルをクエリに追加します。|  
  
 **[クエリ定義]**  
 クエリ定義は、クエリの定義およびテストを行うツール バーおよびペインを提供します。  
  
|ペイン|説明|  
|----------|-----------------|  
|**[ダイアグラム]** ペイン|クエリをダイアグラムに表示します。 このダイアグラムには、クエリに含まれるテーブルと、その結合状態が表示されます。 テーブルの列の横にあるチェック ボックスをオンにすると、クエリの出力にその列が追加されます。オフにすると、削除されます。<br /><br /> テーブルをクエリに追加すると、クエリ ビルダーにより、テーブルのキーに応じてテーブル間の結合が行われます。 結合を追加するには、あるテーブルのフィールドを別のテーブルのフィールドにドラッグします。 結合を管理するには、結合を右クリックしてからメニュー オプションを選択します。<br /><br /> **[ダイアグラム]** ペインを右クリックすると、テーブルの追加や削除、すべてのテーブルの選択、ペインの表示と非表示の切り替えを行うことができます。|  
|**[グリッド]** ペイン|クエリをグリッドに表示します。 このペインを使用して、クエリの列の追加や削除を行うことができます。また、各列の設定も変更できます。|  
|**[SQL]** ペイン|クエリを SQL テストとして表示します。 **[ダイアグラム]** ペインおよび **[グリッド]** ペインで行われた変更がここに表示されます。このペインで行われた変更は、 **[ダイアグラム]** ペインおよび **[グリッド]** ペインに表示されます。|  
|**[結果]** ペイン|ツール バーの **[実行]** をクリックしたときに、クエリの結果が表示されます。| 

