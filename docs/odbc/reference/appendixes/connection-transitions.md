---
description: 接続の遷移
title: 接続の移行 |Microsoft Docs
ms.custom: ''
ms.date: 01/19/2017
ms.prod: sql
ms.prod_service: connectivity
ms.reviewer: ''
ms.technology: connectivity
ms.topic: conceptual
helpviewer_keywords:
- transitioning states [ODBC], connection
- connection transitions [ODBC]
- state transitions [ODBC], connection
ms.assetid: 6b6e1a47-4a52-41c8-bb9e-7ddeae09913e
author: David-Engel
ms.author: v-daenge
ms.openlocfilehash: a5f7fecf0ad25311e9d96f4db8554c1cdbf24e91
ms.sourcegitcommit: e700497f962e4c2274df16d9e651059b42ff1a10
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/17/2020
ms.locfileid: "88339448"
---
# <a name="connection-transitions"></a>接続の遷移
ODBC 接続の状態は次のとおりです。  
  
|州|説明|  
|-----------|-----------------|  
|C0|未割り当ての環境、未割り当ての接続|  
|C1|割り当て済みの環境、未割り当ての接続|  
|C2|割り当て済みの環境、割り当てられた接続|  
|C3|接続関数にはデータが必要です|  
|C4|接続された接続|  
|C5|接続された接続、割り当てられたステートメント|  
|C6|接続されている接続です。トランザクションが進行中です。 接続にステートメントが割り当てられていない状態で、接続が状態 C6 になる可能性があります。 たとえば、接続が手動コミットモードであり、状態が C4 の場合を考えてみます。 ステートメントが割り当てられ、実行された場合 (トランザクションが開始された後)、トランザクションはアクティブなままですが、接続にはステートメントがありません。|  
  
 次の表は、各 ODBC 関数が接続状態にどのように影響するかを示しています。  
  
## <a name="sqlallochandle"></a>SQLAllocHandle  
  
|C0<br /><br /> Env はありません。|未割り当ての C1|C2<br /><br /> Allocated|C3<br /><br /> データが必要|C4<br /><br /> 接続中|C5<br /><br /> ステートメント|C6<br /><br /> トランザクション|  
|--------------------|--------------------|----------------------|----------------------|----------------------|----------------------|------------------------|  
|C1 [1]|--[5]|--[5]|--[5]|--[5]|--[5]|--[5]|  
|(IH)3|C2|--[5]|--[5]|--[5]|--[5]|--[5]|  
|(IH)番|(IH)|(08003)|(08003)|C5|--[5]|--[5]|  
|(IH)4/4|(IH)|(08003)|(08003)|--[5]|--[5]|--[5]|  
  
 [1] この行は、 *Handletype* が SQL_HANDLE_ENV されたときの遷移を示しています。  
  
 [2] この行は、 *Handletype* が SQL_HANDLE_DBC されたときの遷移を示しています。  
  
 [3] この行は、 *Handletype* が SQL_HANDLE_STMT されたときの遷移を示しています。  
  
 [4] この行は、 *Handletype* が SQL_HANDLE_DESC されたときの遷移を示しています。  
  
 [5] 有効なハンドルをポイントする*OutputHandlePtr*で**SQLAllocHandle**を呼び出すと、そのハンドルの前の内容に関係なく、そのハンドルが上書きされ、ODBC ドライバーで問題が発生する可能性があります。 ODBC アプリケーションプログラミングでは、 * \* OutputHandlePtr*に対して定義されているものと同じアプリケーション変数を使用して**SQLAllocHandle**を2回呼び出すことはできません。これを再割り当てする前に、 **sqlfreehandle**を呼び出してハンドルを解放します。 このような方法で ODBC ハンドルを上書きすると、ODBC ドライバーの一部で動作が不安定になったりエラーが発生したりする可能性があります。  
  
## <a name="sqlbrowseconnect"></a>SQLBrowseConnect  
  
|C0<br /><br /> Env はありません。|C1<br /><br /> 未割り当て|C2<br /><br /> Allocated|C3<br /><br /> データが必要|C4<br /><br /> 接続中|C5<br /><br /> ステートメント|C6<br /><br /> トランザクション|  
|--------------------|------------------------|----------------------|----------------------|----------------------|----------------------|------------------------|  
|(IH)|(IH)|C3 [d] C4 [s]|--[d] C2 [e] C4 [s]|(08002)|(08002)|(08002)|  
  
## <a name="sqlclosecursor"></a>SQLCloseCursor  
  
|C0<br /><br /> Env はありません。|C1<br /><br /> 未割り当て|C2<br /><br /> Allocated|C3<br /><br /> データが必要|C4<br /><br /> 接続中|C5<br /><br /> ステートメント|C6<br /><br /> トランザクション|  
|--------------------|------------------------|----------------------|----------------------|----------------------|----------------------|------------------------|  
|(IH)|(IH)|(IH)|(IH)|(IH)|--|--[1] C5 [2]|  
  
 [1] 接続は手動コミットモードです。  
  
 [2] 接続が自動コミットモードになっていました。  
  
## <a name="sqlcolumnprivileges-sqlcolumns-sqlforeignkeys-sqlgettypeinfo-sqlprimarykeys-sqlprocedurecolumns-sqlprocedures-sqlspecialcolumns-sqlstatistics-sqltableprivileges-and-sqltables"></a>SQLColumnPrivileges、SQLColumns、SQLForeignKeys、SQLGetTypeInfo、Sqlcolumnprivileges、SQLProcedureColumns、SQLProcedures、Sql Columns、SQLStatistics、Sqlcolumnprivileges、および SQLTables  
  
|C0<br /><br /> Env はありません。|C1<br /><br /> 未割り当て|C2<br /><br /> Allocated|C3<br /><br /> データが必要|C4<br /><br /> 接続中|C5<br /><br /> ステートメント|C6<br /><br /> トランザクション|  
|--------------------|------------------------|----------------------|----------------------|----------------------|----------------------|------------------------|  
|(IH)|(IH)|(IH)|(IH)|(IH)|--[1] C6 [2]|--|  
  
 [1] 接続が自動コミットモードになりました。または、データソースでトランザクションが開始されませんでした。  
  
 [2] 接続が手動コミットモードであり、データソースがトランザクションを開始しました。  
  
## <a name="sqlconnect"></a>SQLConnect  
  
|C0<br /><br /> Env はありません。|C1<br /><br /> 未割り当て|C2<br /><br /> Allocated|C3<br /><br /> データが必要|C4<br /><br /> 接続中|C5<br /><br /> ステートメント|C6<br /><br /> トランザクション|  
|--------------------|------------------------|----------------------|----------------------|----------------------|----------------------|------------------------|  
|(IH)|(IH)|C4|(08002)|(08002)|(08002)|(08002)|  
  
## <a name="sqlcopydesc-sqlgetdescfield-sqlgetdescrec-sqlsetdescfield-and-sqlsetdescrec"></a>SQLCopyDesc、SQLGetDescField、SQLGetDescRec、SQLSetDescField、および SQLSetDescRec  
  
|C0<br /><br /> Env はありません。|C1<br /><br /> 未割り当て|C2<br /><br /> Allocated|C3<br /><br /> データが必要|C4<br /><br /> 接続中|C5<br /><br /> ステートメント|C6<br /><br /> トランザクション|  
|--------------------|------------------------|----------------------|----------------------|----------------------|----------------------|------------------------|  
|(IH)|(IH)|(IH)|(IH)|--[1]|--|--|  
  
 [1] この状態では、アプリケーションで使用できる唯一の記述子が明示的に割り当てられた記述子です。  
  
## <a name="sqldatasources-and-sqldrivers"></a>SQLDataSources ソースと Sqldatasources  
  
|C0<br /><br /> Env はありません。|C1<br /><br /> 未割り当て|C2<br /><br /> Allocated|C3<br /><br /> データが必要|C4<br /><br /> 接続中|C5<br /><br /> ステートメント|C6<br /><br /> トランザクション|  
|--------------------|------------------------|----------------------|----------------------|----------------------|----------------------|------------------------|  
|(IH)|--|--|--|--|--|--|  
  
## <a name="sqldisconnect"></a>SQLDisconnect  
  
|C0<br /><br /> Env はありません。|C1<br /><br /> 未割り当て|C2<br /><br /> Allocated|C3<br /><br /> データが必要|C4<br /><br /> 接続中|C5<br /><br /> ステートメント|C6<br /><br /> トランザクション|  
|--------------------|------------------------|----------------------|----------------------|----------------------|----------------------|------------------------|  
|(IH)|(IH)|(08003)|C2|C2|C2|25000|  
  
## <a name="sqldriverconnect"></a>SQLDriverConnect  
  
|C0<br /><br /> Env はありません。|C1<br /><br /> 未割り当て|C2<br /><br /> Allocated|C3<br /><br /> データが必要|C4<br /><br /> 接続中|C5<br /><br /> ステートメント|C6<br /><br /> トランザクション|  
|--------------------|------------------------|----------------------|----------------------|----------------------|----------------------|------------------------|  
|(IH)|(IH)|C4 s--n [f]|(08002)|(08002)|(08002)|(08002)|  
  
## <a name="sqlendtran"></a>SQLEndTran  
  
|C0<br /><br /> Env はありません。|C1<br /><br /> 未割り当て|C2<br /><br /> Allocated|C3<br /><br /> データが必要|C4<br /><br /> 接続中|C5<br /><br /> ステートメント|C6<br /><br /> トランザクション|  
|--------------------|------------------------|----------------------|----------------------|----------------------|----------------------|------------------------|  
|(IH)1|--[3]|--[3]|--[3]|--|--|--[4] または ([5]、[6]、[8]) C4 [5] および [7] C5 [5]、[6]、および [9]|  
|(IH)3|(IH)|(08003)|(08003)|--|--|C5|  
  
 [1] この行は、 *Handletype* が SQL_HANDLE_ENV されたときの遷移を示しています。  
  
 [2] この行は、 *Handletype* が SQL_HANDLE_DBC されたときの遷移を示しています。  
  
 [3] 接続が接続状態ではないため、トランザクションの影響を受けません。  
  
 [4] 接続でコミットまたはロールバックに失敗しました。 この場合、関数は SQL_ERROR を返します。  
  
 [5] 接続でコミットまたはロールバックに成功しました。 この関数は、コミットまたはロールバックが別の接続で失敗した場合に SQL_ERROR を返します。または、commit または rollback がすべての接続で成功した場合は SQL_SUCCESS を返します。  
  
 [6] 接続に1つ以上のステートメントが割り当てられました。  
  
 [7] 接続に割り当てられたステートメントがありませんでした。  
  
 [8] 接続には、開いているカーソルを持つステートメントが少なくとも1つ存在します。トランザクションがコミットまたはロールバックされると、データソースはカーソルを保持します (入力候補の *種類* が SQL_COMMIT であるか SQL_ROLLBACK であるかによって異なります)。 詳細については、「 [SQLGetInfo](../../../odbc/reference/syntax/sqlgetinfo-function.md)の SQL_CURSOR_COMMIT_BEHAVIOR と SQL_CURSOR_ROLLBACK_BEHAVIOR 属性」を参照してください。  
  
 [9] 接続に、開いているカーソルを持つステートメントがある場合、トランザクションのコミットまたはロールバック時にカーソルが保持されませんでした。  
  
## <a name="sqlexecdirect-and-sqlexecute"></a>SQLExecDirect と SQLExecute  
  
|C0<br /><br /> Env はありません。|C1<br /><br /> 未割り当て|C2<br /><br /> Allocated|C3<br /><br /> データが必要|C4<br /><br /> 接続中|C5<br /><br /> ステートメント|C6<br /><br /> トランザクション|  
|--------------------|------------------------|----------------------|----------------------|----------------------|----------------------|------------------------|  
|(IH)|(IH)|(IH)|(IH)|(IH)|--[1] C6 [2] C6 [3]|--|  
  
 [1] 接続が自動コミットモードであり、実行されたステートメントがカーソルの*cursor* *指定*(SELECT ステートメントなど) ではありませんでした。または、接続が手動コミットモードであり、実行されたステートメントはトランザクションを開始しませんでした。  
  
 [2] 接続が自動コミットモードになりました。実行されたステートメントは、 *カーソル*の *指定* (select ステートメントなど) でした。  
  
 [3] 接続が手動コミットモードであり、データソースがトランザクションを開始しました。  
  
## <a name="sqlfreehandle"></a>SQLFreeHandle  
  
|C0<br /><br /> Env はありません。|C1<br /><br /> 未割り当て|C2<br /><br /> Allocated|C3<br /><br /> データが必要|C4<br /><br /> 接続中|C5<br /><br /> ステートメント|C6<br /><br /> トランザクション|  
|--------------------|------------------------|----------------------|----------------------|----------------------|----------------------|------------------------|  
|(IH)1|C0|HY010|HY010|HY010|HY010|HY010|  
|(IH)3|(IH)|C1|HY010|HY010|HY010|HY010|  
|(IH)番|(IH)|(IH)|(IH)|(IH)|C4 [5]--[6]|--[7] C4 [5] および [8] C5 [6] および [8]|  
|(IH)4/4|(IH)|(IH)|(IH)|--|--|--|  
  
 [1] この行は、 *Handletype* が SQL_HANDLE_ENV されたときの遷移を示しています。  
  
 [2] この行は、 *Handletype* が SQL_HANDLE_DBC されたときの遷移を示しています。  
  
 [3] この行は、 *Handletype* が SQL_HANDLE_STMT されたときの遷移を示しています。  
  
 [4] この行は、 *Handletype* が SQL_HANDLE_DESC されたときの遷移を示しています。  
  
 [5] 接続に1つのステートメントしか割り当てられませんでした。  
  
 [6] 接続に複数のステートメントが割り当てられました。  
  
 [7] 接続は手動コミットモードです。  
  
 [8] 接続が自動コミットモードになりました。  
  
## <a name="sqlfreestmt"></a>SQLFreeStmt  
  
|C0<br /><br /> Env はありません。|C1<br /><br /> 未割り当て|C2<br /><br /> Allocated|C3<br /><br /> データが必要|C4<br /><br /> 接続中|C5<br /><br /> ステートメント|C6<br /><br /> トランザクション|  
|--------------------|------------------------|----------------------|----------------------|----------------------|----------------------|------------------------|  
|(IH)1|(IH)|(IH)|(IH)|(IH)|--|C5 [3]--[4]|  
|(IH)3|(IH)|(IH)|(IH)|(IH)|--|--|  
  
 [1] この行は、 *オプション* の引数が SQL_CLOSE 場合にトランザクションを示します。  
  
 [2] この行には、 *オプション* の引数が SQL_UNBIND または SQL_RESET_PARAMS ときのトランザクションが表示されます。  
  
 [3] 接続が自動コミットモードになりましたが、この例外を除くステートメントでカーソルが開いていませんでした。  
  
 [4] 接続が手動コミットモードであるか、または自動コミットモードであり、少なくとも1つの他のステートメントでカーソルが開かれていました。  
  
## <a name="sqlgetconnectattr"></a>SQLGetConnectAttr  
  
|C0<br /><br /> Env はありません。|C1<br /><br /> 未割り当て|C2<br /><br /> Allocated|C3<br /><br /> データが必要|C4<br /><br /> 接続中|C5<br /><br /> ステートメント|C6<br /><br /> トランザクション|  
|--------------------|------------------------|----------------------|----------------------|----------------------|----------------------|------------------------|  
|IH|IH|--[1] 08003 [2]|HY010|--|--|--|  
  
 [1] *属性* 引数が SQL_ATTR_ACCESS_MODE、SQL_ATTR_AUTOCOMMIT、SQL_ATTR_LOGIN_TIMEOUT、SQL_ATTR_ODBC_CURSORS、SQL_ATTR_TRACE、または SQL_ATTR_TRACEFILE であったか、または接続属性に値が設定されています。  
  
 [2] *属性* 引数が SQL_ATTR_ACCESS_MODE、SQL_ATTR_AUTOCOMMIT、SQL_ATTR_LOGIN_TIMEOUT、SQL_ATTR_ODBC_CURSORS、SQL_ATTR_TRACE、または SQL_ATTR_TRACEFILE ではなく、接続属性に値が設定されていませんでした。  
  
## <a name="sqlgetdiagfield-and-sqlgetdiagrec"></a>SQLGetDiagField と SQLGetDiagRec  
  
|C0<br /><br /> Env はありません。|C1<br /><br /> 未割り当て|C2<br /><br /> Allocated|C3<br /><br /> データが必要|C4<br /><br /> 接続中|C5<br /><br /> ステートメント|C6<br /><br /> トランザクション|  
|--------------------|------------------------|----------------------|----------------------|----------------------|----------------------|------------------------|  
|(IH)1|--|--|--|--|--|--|  
|(IH)3|(IH)|--|--|--|--|--|  
|(IH)番|(IH)|(IH)|(IH)|(IH)|--|--|  
|(IH)4/4|(IH)|(IH)|(IH)|--|--|--|  
  
 [1] この行は、 *Handletype* が SQL_HANDLE_ENV されたときの遷移を示しています。  
  
 [2] この行は、 *Handletype* が SQL_HANDLE_DBC されたときの遷移を示しています。  
  
 [3] この行は、 *Handletype* が SQL_HANDLE_STMT されたときの遷移を示しています。  
  
 [4] この行は、 *Handletype* が SQL_HANDLE_DESC されたときの遷移を示しています。  
  
## <a name="sqlgetenvattr"></a>SQLGetEnvAttr  
  
|C0<br /><br /> Env はありません。|C1<br /><br /> 未割り当て|C2<br /><br /> Allocated|C3<br /><br /> データが必要|C4<br /><br /> 接続中|C5<br /><br /> ステートメント|C6<br /><br /> トランザクション|  
|--------------------|------------------------|----------------------|----------------------|----------------------|----------------------|------------------------|  
|IH|--|--|--|--|--|--|  
  
## <a name="sqlgetfunctions"></a>SQLGetFunctions  
  
|C0<br /><br /> Env はありません。|C1<br /><br /> 未割り当て|C2<br /><br /> Allocated|C3<br /><br /> データが必要|C4<br /><br /> 接続中|C5<br /><br /> ステートメント|C6<br /><br /> トランザクション|  
|--------------------|------------------------|----------------------|----------------------|----------------------|----------------------|------------------------|  
|IH|IH|HY010|HY010|--|--|--|  
  
## <a name="sqlgetinfo"></a>SQLGetInfo  
  
|C0<br /><br /> Env はありません。|C1<br /><br /> 未割り当て|C2<br /><br /> Allocated|C3<br /><br /> データが必要|C4<br /><br /> 接続中|C5<br /><br /> ステートメント|C6<br /><br /> トランザクション|  
|--------------------|------------------------|----------------------|----------------------|----------------------|----------------------|------------------------|  
|IH|IH|--[1] 08003 [2]|08003|--|--|--|  
  
 [1] *InfoType* 引数が SQL_ODBC_VER でした。  
  
 [2] *InfoType* 引数が SQL_ODBC_VER ませんでした。  
  
## <a name="sqlmoreresults"></a>SQLMoreResults  
  
|C0<br /><br /> Env はありません。|C1<br /><br /> 未割り当て|C2<br /><br /> Allocated|C3<br /><br /> データが必要|C4<br /><br /> 接続中|C5<br /><br /> ステートメント|C6<br /><br /> トランザクション|  
|--------------------|------------------------|----------------------|----------------------|----------------------|----------------------|------------------------|  
|(IH)|(IH)|(IH)|(IH)|(IH)|--[1] C6 [2]|--[3] C5 [1]|  
  
 [1] 接続が自動コミットモードであり、 **Sqlmoreresults** への呼び出しによって、カーソル指定の結果セットの処理が初期化されていません。  
  
 [2] 接続が自動コミットモードになりました。 **Sqlmoreresults** への呼び出しにより、カーソル指定の結果セットの処理が初期化されました。  
  
 [3] 接続は手動コミットモードです。  
  
## <a name="sqlnativesql"></a>SQLNativeSql  
  
|C0<br /><br /> Env はありません。|C1<br /><br /> 未割り当て|C2<br /><br /> Allocated|C3<br /><br /> データが必要|C4<br /><br /> 接続中|C5<br /><br /> ステートメント|C6<br /><br /> トランザクション|  
|--------------------|------------------------|----------------------|----------------------|----------------------|----------------------|------------------------|  
|(IH)|(IH)|(08003)|(08003)|--|--|--|  
  
## <a name="sqlprepare"></a>SQLPrepare  
  
|C0<br /><br /> Env はありません。|C1<br /><br /> 未割り当て|C2<br /><br /> Allocated|C3<br /><br /> データが必要|C4<br /><br /> 接続中|C5<br /><br /> ステートメント|C6<br /><br /> トランザクション|  
|--------------------|------------------------|----------------------|----------------------|----------------------|----------------------|------------------------|  
|(IH)|(IH)|(IH)|(IH)|(IH)|--[1] C6 [2]|--|  
  
 [1] 接続が自動コミットモードになりました。または、データソースでトランザクションが開始されませんでした。  
  
 [2] 接続が手動コミットモードであり、データソースがトランザクションを開始しました。  
  
## <a name="sqlsetconnectattr"></a>SQLSetConnectAttr  
  
|C0<br /><br /> Env はありません。|C1<br /><br /> 未割り当て|C2<br /><br /> Allocated|C3<br /><br /> データが必要|C4<br /><br /> 接続中|C5<br /><br /> ステートメント|C6<br /><br /> トランザクション|  
|--------------------|------------------------|----------------------|----------------------|----------------------|----------------------|------------------------|  
|IH|IH|--[1] 08003 [2]|HY010|--[3] 08002 [4] HY011 [5]|--[3] 08002 [4] HY011 [5]|--[3] と [6] C5 [8] 08002 [4] HY011 [5] または [7]|  
  
 [1] *属性* 引数が SQL_ATTR_TRANSLATE_LIB または SQL_ATTR_TRANSLATE_OPTION ませんでした。  
  
 [2] *属性* 引数が SQL_ATTR_TRANSLATE_LIB または SQL_ATTR_TRANSLATE_OPTION でした。  
  
 [3] *属性* 引数が SQL_ATTR_ODBC_CURSORS または SQL_ATTR_PACKET_SIZE ませんでした。  
  
 [4] *属性* 引数が SQL_ATTR_ODBC_CURSORS でした。  
  
 [5] *属性* 引数が SQL_ATTR_PACKET_SIZE でした。  
  
 [6] *属性* 引数が SQL_ATTR_AUTOCOMMIT なかったか、 *属性* 引数が SQL_ATTR_AUTOCOMMIT ました。この属性を設定しても、トランザクションはコミットされませんでした。  
  
 [7] *属性* 引数が SQL_ATTR_TXN_ISOLATION でした。  
  
 [8] *属性* 引数が SQL_ATTR_AUTOCOMMIT ました。この属性を設定すると、トランザクションがコミットされました。  
  
## <a name="sqlsetenvattr"></a>SQLSetEnvAttr  
  
|C0<br /><br /> Env はありません。|C1<br /><br /> 未割り当て|C2<br /><br /> Allocated|C3<br /><br /> データが必要|C4<br /><br /> 接続中|C5<br /><br /> ステートメント|C6<br /><br /> トランザクション|  
|--------------------|------------------------|----------------------|----------------------|----------------------|----------------------|------------------------|  
|(IH)|--|--|HY010|--|--|--|  
  
## <a name="all-other-odbc-functions"></a>その他すべての ODBC 関数  
  
|C0<br /><br /> Env はありません。|C1<br /><br /> 未割り当て|C2<br /><br /> Allocated|C3<br /><br /> データが必要|C4<br /><br /> 接続中|C5<br /><br /> ステートメント|C6<br /><br /> トランザクション|  
|--------------------|------------------------|----------------------|----------------------|----------------------|----------------------|------------------------|  
|(IH)|(IH)|(IH)|(IH)|(IH)|--|--|
