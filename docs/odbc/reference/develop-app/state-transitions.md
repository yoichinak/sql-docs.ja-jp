---
description: 状態遷移
title: 状態遷移 |Microsoft Docs
ms.custom: ''
ms.date: 01/19/2017
ms.prod: sql
ms.prod_service: connectivity
ms.reviewer: ''
ms.technology: connectivity
ms.topic: conceptual
helpviewer_keywords:
- state transitions [ODBC]
- unallocated state [ODBC]
- handles [ODBC], state transitions
- allocated state [ODBC]
- connection state [ODBC]
ms.assetid: fc741611-6535-43cc-8156-6d897d04664e
author: David-Engel
ms.author: v-daenge
ms.openlocfilehash: 947be49fc0a77f94c1641bb7c735db3276b49f58
ms.sourcegitcommit: e700497f962e4c2274df16d9e651059b42ff1a10
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/17/2020
ms.locfileid: "88476364"
---
# <a name="state-transitions"></a>状態遷移
ODBC では、各環境、各接続、および各ステートメントの個別の *状態* が定義されます。 たとえば、環境には、未割り当て (環境が割り当てられていない)、割り当て済み (環境が割り当てられているが、接続が割り当てられていない)、接続 (環境と1つ以上の接続が割り当てられている) の3つの状態があります。 接続には、7つの状態があります。ステートメントには、可能な状態が13個あります。  
  
 特定の項目がハンドルによって識別されると、アプリケーションが特定の関数または関数を呼び出し、その項目にハンドルを渡すと、ある状態から別の項目に移動します。 このような移動は、 *状態遷移*と呼ばれます。 たとえば、 **SQLAllocHandle** を使用して環境ハンドルを割り当てると、環境が未割り当てから割り当て済みに移動し、 **sqlfreehandle** でそのハンドルを解放すると、割り当てられたから未割り当てに戻されます。 ODBC では、制限された数の有効な状態遷移を定義します。これは、関数を特定の順序で呼び出す必要があることを示すもう1つの方法です。  
  
 **Sqlgetconnectattr**などの一部の関数は、状態には影響しません。 その他の関数は、1つのアイテムの状態に影響を与えます。 たとえば、 **Sqldisconnect** は接続を接続状態から割り当てられた状態に移動します。 最後に、複数の項目の状態に影響を与える関数もあります。 たとえば、 **SQLAllocHandle** を使用して接続ハンドルを割り当てると、接続が未割り当てから割り当て済みの状態に移行され、割り当てられたから接続状態に環境が移動します。  
  
 アプリケーションが順序どおりに関数を呼び出すと、関数は *状態遷移エラー*を返します。 たとえば、環境が接続状態であり、アプリケーションがその環境ハンドルで **Sqlfreehandle** を呼び出した場合、 **SQLFREEHANDLE** は SQLSTATE HY010 (関数シーケンスエラー) を返します。これは、環境が割り当てられた状態のときにのみ呼び出すことができるためです。 これを無効な状態遷移として定義すると、アクティブな接続がある間、ODBC によってアプリケーションの環境が解放されるのを防ぐことができます。  
  
 状態遷移の中には、ODBC の設計に固有のものがあります。 たとえば、接続ハンドルを割り当てる関数には環境ハンドルが必要であるため、最初に環境ハンドルを割り当てることなく接続ハンドルを割り当てることはできません。 その他の状態遷移は、ドライバーマネージャーとドライバーによって適用されます。 たとえば、 **Sqlexecute** は準備されたステートメントを実行します。 に渡されたステートメントハンドルが準備された状態ではない場合、 **Sqlexecute** は SQLSTATE HY010 (関数シーケンスエラー) を返します。  
  
 アプリケーションの観点から見ると、状態遷移は通常は簡単です。つまり、適正な状態遷移は、適切に記述されたアプリケーションのフローと一緒に手に入る傾向があります。 状態遷移は、ドライバーマネージャーとドライバーによってより複雑になります。これは、環境、各接続、および各ステートメントの状態を追跡する必要があるためです。 この作業の大部分は、ドライバーマネージャーによって行われます。ドライバーで実行する必要のある作業のほとんどは、保留中の結果を含むステートメントで発生します。  
  
 このマニュアルのパート1と 2 (「ODBC の概要」と「アプリケーションとドライバーの開発」) は、状態遷移を明示的に言及しない傾向があります。 代わりに、関数を呼び出す順序を記述します。 たとえば、"実行中のステートメント" とは、 **Sqlexecute**を使用して実行する前に、 **SQLPrepare**を使用してステートメントを準備する必要があることを示します。 ドライバーマネージャーによってチェックされ、ドライバーによって確認する必要がある遷移など、状態と状態遷移の詳細については、「 [付録 B: ODBC 状態遷移テーブル](../../../odbc/reference/appendixes/appendix-b-odbc-state-transition-tables.md)」を参照してください。
